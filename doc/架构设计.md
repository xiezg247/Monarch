### 单点登录方案
![单点登录](3275419806.jpeg)

这个方案比较简单，不需要第三个系统的出现，提供公共的SDK即可，这个SDK的工作需要管理Cookie和用户信息。

原理： 利用了`二级域名`写`一级域名`的`Cookie`。

优点：轻量级、可插拔、效率非常高。

缺点：局限性限于一级域名是一样的。

### SDK
[Flask-Session](http://pythonhosted.org/Flask-Session/)

### Server配置
```python
# Session Server 配置
SESSION_TYPE = "redis"  # 存储
SESSION_PERMANENT = True
SESSION_LIFETIME = 60 * 60 * 3  # 三小时过期
SESSION_COOKIE_DOMAIN = ".test.com"  # 一级域名
SESSION_REDIS = redis.StrictRedis.from_url(REDIS_URL, max_connections=REDIS_MAX_CONNECTIONS)
```

### Client配置
```python
# Session Server 配置
SESSION_TYPE = "redis"
SESSION_PERMANENT = True
SESSION_KEY = "session_key"
SESSION_REDIS = redis.StrictRedis.from_url(REDIS_URL, max_connections=REDIS_MAX_CONNECTIONS)
```

#### 安装Client SDK
pip install git+http://account:password@192.168.3.101/zhiyun/Flask-Session-Client.git

#### 需要登录验证的资源
```python
from flask_session_client import login_required, user_logged_out

class UserDto:
    ns = Namespace("user", description="用户接口")
    user = ns.model("user", {"name": fields.String(required=True, description="用户姓名")})


ns = UserDto.ns


@ns.route("")
class UserList(Resource):
    @ns.doc("查找所有用户")
    @ns.response(model=UserDto.user, code=HTTPStatus.OK.value, description="成功查找用户")
    @ns.response(code=HTTPStatus.NOT_FOUND.value, description="暂无用户")
    @login_required
    def get(self):
        """查找所有用户 """
        return get_users()
```

#### 退出
```python
@ns.route("/logout")
class UserLogout(Resource):
    @ns.doc("用户注销")
    def get(self):
        user_logged_out()
        return biz_success()
```
